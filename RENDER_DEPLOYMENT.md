# üöÄ Render.com Deployment Guide

Complete guide to deploy Satyasetu Chatbot on Render.com (Free tier).

## üìã Prerequisites

1. ‚úÖ GitHub account with code pushed
2. ‚úÖ Render.com account (sign up at [render.com](https://render.com))
3. ‚úÖ MongoDB Atlas connection string
4. ‚úÖ Groq API key

## üéØ Step-by-Step Deployment

### Step 1: Push Code to GitHub

```bash
git add .
git commit -m "Add Render deployment configuration"
git push origin main
```

### Step 2: Create Render Account

1. Go to [render.com](https://render.com)
2. Click "Get Started for Free"
3. Sign up with GitHub (recommended)
4. Authorize Render to access your repositories

### Step 3: Create New Web Service

1. Click "New +" button (top right)
2. Select "Web Service"
3. Connect your GitHub repository: `SakshamSharma2005/satyasetu-chatbot`
4. Click "Connect"

### Step 4: Configure Web Service

Render will auto-detect the `render.yaml` file. Verify these settings:

**Basic Settings:**
- **Name**: `satyasetu-chatbot` (or your choice)
- **Region**: Oregon (US West)
- **Branch**: `main`
- **Runtime**: Python 3
- **Build Command**: `pip install --upgrade pip && pip install -r requirements.txt`
- **Start Command**: `uvicorn app.main:app --host 0.0.0.0 --port $PORT`

**Plan:**
- Select **Free** (sufficient for testing)

### Step 5: Add Environment Variables

Click "Environment" tab and add:

```env
# MongoDB (REQUIRED)
MONGODB_URL=mongodb+srv://username:password@cluster.mongodb.net/
MONGODB_DB_NAME=SatyaSetu

# Groq API (REQUIRED)
GROQ_API_KEY=gsk_your_groq_api_key_here
GROQ_MODEL=llama-3.1-8b-instant

# Security (Auto-generated by Render)
SECRET_KEY=<auto-generated>
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=10080

# Application
APP_NAME=Satyasetu Chatbot
APP_VERSION=1.0.0
ENVIRONMENT=production
DEBUG=False

# CORS (Add your frontend domain)
CORS_ORIGINS=["*"]

# ChromaDB
CHROMA_PERSIST_DIRECTORY=/opt/render/project/src/chroma_db

# Models
TRANSLATION_MODEL=ai4bharat/indictrans2-en-indic-dist-200M
EMBEDDING_MODEL=sentence-transformers/all-MiniLM-L6-v2
```

**Important:**
- Mark `MONGODB_URL` and `GROQ_API_KEY` as "Secret" (click the lock icon)
- Render auto-generates `SECRET_KEY` if you use `generateValue: true` in render.yaml

### Step 6: Add Persistent Disk (for ChromaDB)

1. Scroll to "Disks" section
2. Click "Add Disk"
3. Configure:
   - **Name**: `chroma-data`
   - **Mount Path**: `/opt/render/project/src/chroma_db`
   - **Size**: 1 GB (free tier)

### Step 7: Deploy

1. Click "Create Web Service"
2. Render will:
   - Clone your repository
   - Install dependencies (~3-5 minutes)
   - Start the application
   - Assign a public URL

**Watch the logs** for any errors during deployment.

### Step 8: Verify Deployment

Once deployed, you'll get a URL like: `https://satyasetu-chatbot.onrender.com`

Test these endpoints:

```bash
# Health check
curl https://satyasetu-chatbot.onrender.com/health

# Root endpoint
curl https://satyasetu-chatbot.onrender.com/

# API docs
https://satyasetu-chatbot.onrender.com/docs
```

### Step 9: Initialize Knowledge Base (Optional)

If you need to load knowledge base data:

1. Go to Render dashboard
2. Open your service
3. Click "Shell" tab
4. Run:
```bash
python load_satyasetu_data.py
```

## üîß Configuration Details

### MongoDB Atlas Setup

If you haven't set up MongoDB Atlas:

1. Go to [mongodb.com/cloud/atlas](https://www.mongodb.com/cloud/atlas)
2. Create free cluster
3. Create database user
4. Whitelist IP: `0.0.0.0/0` (allow all - for Render)
5. Get connection string
6. Add to Render environment variables

### Groq API Key

1. Go to [console.groq.com](https://console.groq.com)
2. Sign up (free)
3. Create API key
4. Copy and add to Render

### CORS Configuration

For production, update `CORS_ORIGINS`:

```env
CORS_ORIGINS=["https://your-frontend.com","https://www.your-frontend.com"]
```

## üìä Monitoring & Logs

### View Logs
1. Go to Render dashboard
2. Click on your service
3. Click "Logs" tab
4. Real-time logs appear here

### Monitor Health
- Health endpoint: `/health`
- Render auto-restarts if health check fails
- View metrics in dashboard

## üîÑ Continuous Deployment

Render auto-deploys when you push to GitHub:

```bash
# Make changes
git add .
git commit -m "Update feature"
git push origin main

# Render automatically:
# 1. Detects push
# 2. Pulls latest code
# 3. Rebuilds
# 4. Deploys new version
```

## ‚ö° Free Tier Limits

Render Free tier includes:
- ‚úÖ 750 hours/month runtime
- ‚úÖ Automatic SSL/HTTPS
- ‚úÖ 1 GB persistent disk
- ‚úÖ Auto-deploy on git push
- ‚ö†Ô∏è Spins down after 15 minutes of inactivity
- ‚ö†Ô∏è Cold start: ~30 seconds to wake up

**Note:** First request after inactivity takes longer (cold start).

## üêõ Troubleshooting

### Build Fails

**Error: Dependencies installation failed**
```bash
# Check requirements.txt for incompatible versions
# Fix: Update requirements.txt and push
```

**Error: Python version mismatch**
```bash
# Ensure runtime.txt has: python-3.11.7
# Or set PYTHON_VERSION env var
```

### App Crashes

**Check logs for:**
1. MongoDB connection errors
   - Verify MONGODB_URL is correct
   - Check MongoDB Atlas IP whitelist

2. Missing environment variables
   - Verify all required vars are set
   - Check for typos in variable names

3. Port binding issues
   - Render sets PORT automatically
   - Ensure app uses: `--port $PORT`

### Slow Response

**Cause:** Cold start (free tier)
**Solution:** 
- Upgrade to paid plan ($7/month)
- Or accept 30s initial delay
- Use cron-job.org to ping every 14 minutes (keeps alive)

### ChromaDB Data Loss

**Cause:** No persistent disk
**Solution:**
- Ensure disk is mounted at `/opt/render/project/src/chroma_db`
- Check disk is created in Render dashboard

## üîê Security Best Practices

1. **Secrets Management**
   - Never commit `.env` files
   - Use Render's environment variables
   - Mark sensitive vars as "Secret"

2. **CORS Configuration**
   - Don't use `["*"]` in production
   - Specify exact frontend domains

3. **API Keys**
   - Rotate keys periodically
   - Use separate keys for dev/prod

4. **Database Access**
   - Use MongoDB user with minimal permissions
   - Enable MongoDB authentication
   - Restrict IP access when possible

## üöÄ Production Checklist

Before going live:

- [ ] MongoDB connection string added
- [ ] Groq API key configured
- [ ] SECRET_KEY generated (strong)
- [ ] CORS_ORIGINS set to frontend domain
- [ ] DEBUG=False in production
- [ ] Persistent disk mounted for ChromaDB
- [ ] Health check endpoint working
- [ ] API documentation accessible at /docs
- [ ] Test all endpoints (auth, chat, student)
- [ ] Load knowledge base data
- [ ] Set up custom domain (optional)

## üì± Frontend Integration

Once deployed, update your frontend to use the Render URL:

```javascript
// Example: React/Next.js
const API_URL = "https://satyasetu-chatbot.onrender.com";

// Login
fetch(`${API_URL}/auth/mongo/login`, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ email, password })
});

// Chat
fetch(`${API_URL}/chat/mongo`, {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
    "Authorization": `Bearer ${token}`
  },
  body: JSON.stringify({ message, language: "en" })
});
```

## üí∞ Cost Optimization

**Free Tier Tips:**
- Keep app lightweight
- Use external services (MongoDB Atlas free, Groq free)
- Accept cold starts
- Monitor usage in Render dashboard

**Paid Tier ($7/month):**
- No cold starts
- Better performance
- More disk space
- Priority support

## üìû Support

- **Render Docs**: [docs.render.com](https://docs.render.com)
- **Community**: [community.render.com](https://community.render.com)
- **Status**: [status.render.com](https://status.render.com)

---

## üéâ Success!

Your Satyasetu Chatbot is now live at:
- **API**: `https://satyasetu-chatbot.onrender.com`
- **Docs**: `https://satyasetu-chatbot.onrender.com/docs`
- **Health**: `https://satyasetu-chatbot.onrender.com/health`

Share this URL with your frontend team for integration!
